<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vonalkód Feladat</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f0f0;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            text-align: center;
            background-color: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #111;
            font-size: 2.2em;
            margin-bottom: 30px;
        }
        
        .task-code-container {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        .task-code-container input {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 1em;
            width: 200px;
        }
        .task-code-container button {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            background-color: #007bff;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .task-code-container button:hover {
            background-color: #0056b3;
        }
        .task-code-container p {
            margin: 0;
            font-size: 0.9em;
            color: #555;
        }
        #current-task-code {
            font-weight: bold;
            color: #333;
            background-color: #e9e9e9;
            padding: 3px 6px;
            border-radius: 4px;
        }

        .barcode-main-display {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 5px;
            margin-bottom: 40px;
        }
        .main-bars-wrapper {
             display: flex;
             align-items: flex-start;
        }
        .digit-label-outer {
            font-size: 1.5em;
            font-weight: bold;
            padding-bottom: 5px;
        }
        
        .barcode-digit-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 2px;
        }

        .barcode-bars-container {
            display: flex;
            height: 100px; 
            align-items: flex-start;
        }
        
        .barcode-bar {
            width: 2.5px;
            background-color: #000;
        }
        .barcode-space {
            width: 2.5px;
            background-color: #fff;
        }
        
        .bar-normal { height: 90px; }
        .bar-long { height: 100px; }

        .digit-label {
            margin-top: 8px;
            font-size: 1.5em;
            font-weight: bold;
            color: #222;
        }
        
        .torn-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 90px;
            width: calc(2.5px * 7);
            margin: 0 2px;
            background-color: #f5f5f5;
            border: 3px dashed #999;
            border-radius: 5px;
            box-sizing: border-box;
            cursor: pointer;
            margin-bottom: 35px;
        }
        .torn-section:hover {
            border-color: #555;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-top: 40px;
            width: 100%;
        }

        .option {
            background-color: #e0e0e0;
            color: #333;
            padding: 25px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: border-color 0.3s, transform 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            min-height: 120px; 
            box-sizing: border-box;
        }

        .option:hover {
            border-color: #b0b0b0;
            transform: translateY(-2px);
        }

        .option.selected-correct { border-color: #28a745; }
        .option.selected-incorrect { border-color: #dc3545; }
        
        .feedback {
            margin-top: 40px;
            font-size: 2em;
            font-weight: bold;
            min-height: 2em;
        }
        
        .correct { color: #28a745; }
        .incorrect { color: #dc3545; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Válaszd ki a hiányzó vonalkód részletet!</h1>
        
        <div class="task-code-container">
            <input type="number" id="task-code-input" placeholder="Írd be a feladatkódot">
            <button id="generate-from-code">Feladat Generálása</button>
            <p>Kód: <strong id="current-task-code">N/A</strong></p>
        </div>

        <div class="barcode-main-display" id="barcode-container"></div>
        <div class="options-container" id="options-container"></div>
        <div class="feedback" id="feedback-message"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const upcAPatterns = {
                L: { '0': '0001101', '1': '0011001', '2': '0010011', '3': '0111101', '4': '0100011', '5': '0110001', '6': '0101111', '7': '0111011', '8': '0110111', '9': '0001011' },
                R: { '0': '1110010', '1': '1100110', '2': '1101100', '3': '1000010', '4': '1011100', '5': '1001110', '6': '1010000', '7': '1000100', '8': '1001000', '9': '1110100' }
            };
            const guardPatterns = { start: '101', middle: '01010', end: '101' };

            const barcodeContainer = document.getElementById('barcode-container');
            const optionsContainer = document.getElementById('options-container');
            const feedbackMessage = document.getElementById('feedback-message');
            const taskCodeInput = document.getElementById('task-code-input');
            const generateFromCodeBtn = document.getElementById('generate-from-code');
            const currentTaskCodeSpan = document.getElementById('current-task-code');
            
            let fullBarcodeCode = '';
            let missingIndex = -1;
            let missingPatternType = '';
            
            function mulberry32(a) {
                return function() {
                  var t = a += 0x6D2B79F5;
                  t = Math.imul(t ^ t >>> 15, t | 1);
                  t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                  return ((t ^ t >>> 14) >>> 0) / 4294967296;
                }
            }
            
            let seededRandom;

            function generateBarcodePart(digit, patternType, context = 'main', showLabel = true) {
                const pattern = upcAPatterns[patternType][digit];
                let barsHtml = '';
                const barHeightClass = 'bar-normal';
                for (let i = 0; i < pattern.length; i++) {
                    barsHtml += `<div class="${pattern[i] === '1' ? 'barcode-bar' : 'barcode-space'} ${barHeightClass}"></div>`;
                }
                const digitLabelHtml = (context === 'main' && showLabel) ? `<div class="digit-label">${digit}</div>` : '';
                return `
                    <div class="barcode-digit-group">
                        <div class="barcode-bars-container">${barsHtml}</div>
                        ${digitLabelHtml}
                    </div>`;
            }
            
            function generateGuardBars(pattern, type) {
                let barsHtml = '';
                const barHeightType = 'bar-long';
                for (let i = 0; i < pattern.length; i++) {
                    barsHtml += `<div class="${pattern[i] === '1' ? 'barcode-bar' : 'barcode-space'} ${barHeightType}"></div>`;
                }
                 return `<div class="barcode-digit-group" style="margin-bottom: 35px;"><div class="barcode-bars-container">${barsHtml}</div></div>`;
            }

            function generateTornSection() {
                return `<div class="torn-section">?</div>`;
            }

            function calculateCheckDigit(code) {
                let oddSum = 0;
                let evenSum = 0;
                for (let i = 0; i < 10; i++) {
                    const digit = parseInt(code[i]);
                    if ((i + 1) % 2 !== 0) {
                        oddSum += digit;
                    } else {
                        evenSum += digit;
                    }
                }
                const totalSum = (oddSum * 3) + evenSum;
                const remainder = totalSum % 10;
                return remainder === 0 ? 0 : 10 - remainder;
            }

            function generateFullUpcCode() {
                const firstDigit = Math.floor(seededRandom() * 10).toString();
                let dataDigits = '';
                for (let i = 0; i < 10; i++) {
                    dataDigits += Math.floor(seededRandom() * 10);
                }
                const checkDigit = calculateCheckDigit(dataDigits);
                return firstDigit + dataDigits + checkDigit;
            }

            function renderBarcode(code, missingIdx, showMissingPart) {
                barcodeContainer.innerHTML = ''; 
                const firstDigitLabel = document.createElement('div');
                firstDigitLabel.className = 'digit-label-outer';
                firstDigitLabel.textContent = code[0];
                barcodeContainer.appendChild(firstDigitLabel);
                const mainBarsWrapper = document.createElement('div');
                mainBarsWrapper.className = 'main-bars-wrapper';
                let mainBarsHtml = '';
                mainBarsHtml += generateGuardBars(guardPatterns.start, 'start');
                for (let i = 0; i < 6; i++) {
                    const showLabel = i > 0;
                    if (i === missingIdx) {
                        mainBarsHtml += showMissingPart ? generateBarcodePart(code[i], 'L', 'main', showLabel) : generateTornSection();
                    } else {
                        mainBarsHtml += generateBarcodePart(code[i], 'L', 'main', showLabel);
                    }
                }
                mainBarsHtml += generateGuardBars(guardPatterns.middle, 'middle');
                for (let i = 6; i < 12; i++) {
                    const showLabel = i < 11;
                    if (i === missingIdx) {
                        mainBarsHtml += showMissingPart ? generateBarcodePart(code[i], 'R', 'main', showLabel) : generateTornSection();
                    } else {
                        mainBarsHtml += generateBarcodePart(code[i], 'R', 'main', showLabel);
                    }
                }
                mainBarsHtml += generateGuardBars(guardPatterns.end, 'end');
                mainBarsWrapper.innerHTML = mainBarsHtml;
                barcodeContainer.appendChild(mainBarsWrapper);
                const lastDigitLabel = document.createElement('div');
                lastDigitLabel.className = 'digit-label-outer';
                lastDigitLabel.textContent = code[11];
                barcodeContainer.appendChild(lastDigitLabel);
            }

            function setupProblem(seed = null) {
                let taskCode;
                if (seed) {
                    taskCode = parseInt(seed, 10);
                    if (isNaN(taskCode)) {
                        alert('Érvénytelen feladatkód. A kódnak egész számnak kell lennie. Véletlenszerű feladat generálása következik.');
                        setupProblem();
                        return;
                    }
                } else {
                    taskCode = Math.floor(Math.random() * 2147483647);
                }

                seededRandom = mulberry32(taskCode);

                fullBarcodeCode = generateFullUpcCode();
                missingIndex = Math.floor(seededRandom() * 12);
                const correctDigit = fullBarcodeCode[missingIndex];
                missingPatternType = missingIndex < 6 ? 'L' : 'R';
                
                currentTaskCodeSpan.textContent = taskCode;
                taskCodeInput.value = '';
                feedbackMessage.textContent = '';
                feedbackMessage.className = 'feedback';
                
                renderBarcode(fullBarcodeCode, missingIndex, false);
                generateOptions(correctDigit);
            }
            
            function generateOptions(correctDigit) {
                optionsContainer.innerHTML = '';
                let options = [{ digit: correctDigit, isCorrect: true }];
                const usedDigits = new Set([correctDigit]);

                while (options.length < 6) {
                    let randomDigit = Math.floor(seededRandom() * 10).toString();
                    if (!usedDigits.has(randomDigit)) {
                        options.push({ digit: randomDigit, isCorrect: false });
                        usedDigits.add(randomDigit);
                    }
                }
                
                options.sort(() => seededRandom() - 0.5);

                options.forEach(option => {
                    const div = document.createElement('div');
                    div.className = 'option';
                    div.innerHTML = generateBarcodePart(option.digit, missingPatternType, 'option', false);
                    div.dataset.isCorrect = option.isCorrect;
                    div.addEventListener('click', handleOptionClick);
                    optionsContainer.appendChild(div);
                });
            }

            function handleOptionClick(event) {
                const clickedOption = event.currentTarget;
                if (clickedOption.classList.contains('selected-correct') || clickedOption.classList.contains('selected-incorrect')) {
                    return;
                }
                const isCorrect = clickedOption.dataset.isCorrect === 'true';

                document.querySelectorAll('.option').forEach(option => {
                     option.removeEventListener('click', handleOptionClick);
                     option.style.cursor = 'default';
                });

                if (isCorrect) {
                    clickedOption.classList.add('selected-correct');
                    feedbackMessage.textContent = 'Helyes megoldás. 🎉';
                    feedbackMessage.className = 'feedback correct';
                    setTimeout(() => {
                        renderBarcode(fullBarcodeCode, missingIndex, true);
                        optionsContainer.innerHTML = '';
                        setTimeout(() => setupProblem(), 3000);
                    }, 1000);
                } else {
                    clickedOption.classList.add('selected-incorrect');
                    feedbackMessage.textContent = 'Próbáld újra! ❌';
                    feedbackMessage.className = 'feedback incorrect';
                     setTimeout(() => {
                        clickedOption.classList.remove('selected-incorrect');
                        document.querySelectorAll('.option').forEach(option => {
                           option.addEventListener('click', handleOptionClick);
                           option.style.cursor = 'pointer';
                        });
                        feedbackMessage.textContent = '';
                     }, 2000);
                }
            }
            
            generateFromCodeBtn.addEventListener('click', () => {
                const code = taskCodeInput.value.trim();
                if (code) {
                    setupProblem(code);
                }
            });

            setupProblem();
        });
    </script>
</body>
</html>